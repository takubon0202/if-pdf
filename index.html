<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF ツール</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- ===== ツール選択画面 ===== -->
  <div id="home" class="container">
    <h1>PDF ツール</h1>
    <p class="subtitle">すべてブラウザ上で完結。サーバーへのアップロード不要。</p>

    <div class="tool-grid">
      <button class="tool-card" data-tool="pdf-to-image">
        <span class="tool-icon">🖼</span>
        <span class="tool-name">PDF → 画像</span>
        <span class="tool-desc">PDFをPNG/JPEG/WebPに変換</span>
      </button>
      <button class="tool-card" data-tool="img-to-pdf">
        <span class="tool-icon">📄</span>
        <span class="tool-name">画像 → PDF</span>
        <span class="tool-desc">画像ファイルをPDFに変換</span>
      </button>
      <button class="tool-card" data-tool="merge">
        <span class="tool-icon">📎</span>
        <span class="tool-name">PDF 結合</span>
        <span class="tool-desc">複数PDFを1つに統合</span>
      </button>
      <button class="tool-card" data-tool="split">
        <span class="tool-icon">✂️</span>
        <span class="tool-name">PDF 分割</span>
        <span class="tool-desc">PDFを複数ファイルに分割</span>
      </button>
      <button class="tool-card" data-tool="delete">
        <span class="tool-icon">🗑</span>
        <span class="tool-name">ページ削除</span>
        <span class="tool-desc">不要なページを削除</span>
      </button>
      <button class="tool-card" data-tool="extract">
        <span class="tool-icon">📤</span>
        <span class="tool-name">ページ抽出</span>
        <span class="tool-desc">必要なページだけ抽出</span>
      </button>
      <button class="tool-card" data-tool="organize">
        <span class="tool-icon">🔀</span>
        <span class="tool-name">ページ並び替え</span>
        <span class="tool-desc">ページの順番を変更</span>
      </button>
      <button class="tool-card" data-tool="rotate">
        <span class="tool-icon">🔄</span>
        <span class="tool-name">PDF 回転</span>
        <span class="tool-desc">ページの向きを回転</span>
      </button>
      <button class="tool-card" data-tool="pagenums">
        <span class="tool-icon">#</span>
        <span class="tool-name">ページ番号</span>
        <span class="tool-desc">ページ番号を追加</span>
      </button>
      <button class="tool-card" data-tool="watermark">
        <span class="tool-icon">💧</span>
        <span class="tool-name">透かし追加</span>
        <span class="tool-desc">テキスト透かしを挿入</span>
      </button>
      <button class="tool-card" data-tool="compress">
        <span class="tool-icon">📦</span>
        <span class="tool-name">PDF 圧縮</span>
        <span class="tool-desc">ファイルサイズを削減</span>
      </button>
    </div>
  </div>

  <!-- ===== 各ツール画面 ===== -->

  <!-- PDF → 画像 -->
  <div id="tool-pdf-to-image" class="tool-view" hidden>
    <div class="container">
      <button class="back-btn" data-back>&larr; ツール一覧に戻る</button>
      <h2>PDF → 画像変換</h2>
      <div class="upload-area" id="png-drop-area">
        <p>PDFファイルをドラッグ&ドロップ<br>または</p>
        <label class="file-label">ファイルを選択<input type="file" id="png-file-input" accept=".pdf" hidden></label>
      </div>
      <div class="options" id="png-options" style="display:none;">
        <label>形式: <select id="format-select"><option value="png" selected>PNG</option><option value="jpeg">JPEG</option><option value="webp">WebP</option></select></label>
        <label id="quality-label" style="display:none;">品質: <input type="range" id="quality-range" min="10" max="100" value="90" step="5"><span id="quality-value">90%</span></label>
        <label>解像度: <select id="scale-select"><option value="1">1x</option><option value="2" selected>2x</option><option value="3">3x</option></select></label>
        <button id="convert-btn" class="btn secondary">設定を変えて再変換</button>
        <button id="png-reset-btn" class="btn secondary">別のファイルを選択</button>
      </div>
      <div class="progress-wrapper" id="png-progress" style="display:none;"><div class="progress-bar"><div class="progress-fill" id="png-progress-fill"></div></div><p class="progress-text" id="png-progress-text"></p></div>
      <div id="png-results" class="results"></div>
      <div id="png-download-all" style="display:none;"><button id="download-zip-btn" class="btn primary">ZIP で一括ダウンロード</button></div>
    </div>
  </div>

  <!-- 画像 → PDF -->
  <div id="tool-img-to-pdf" class="tool-view" hidden>
    <div class="container">
      <button class="back-btn" data-back>&larr; ツール一覧に戻る</button>
      <h2>画像 → PDF 変換</h2>
      <div class="upload-area" id="img-drop-area">
        <p>画像ファイルをドラッグ&ドロップ<br>または</p>
        <label class="file-label">ファイルを選択<input type="file" id="img-file-input" accept="image/*" multiple hidden></label>
      </div>
      <div id="img-file-list" class="file-list"></div>
      <div id="img-actions" style="display:none;">
        <label>ページサイズ: <select id="img-page-size"><option value="fit">画像に合わせる</option><option value="a4">A4</option><option value="letter">Letter</option></select></label>
        <button id="img-add-more" class="btn secondary">画像を追加</button>
        <input type="file" id="img-add-input" accept="image/*" multiple hidden>
        <button id="img-convert-btn" class="btn primary">PDFに変換</button>
      </div>
      <div class="progress-wrapper" id="img-progress" style="display:none;"><div class="progress-bar"><div class="progress-fill" id="img-progress-fill"></div></div><p class="progress-text" id="img-progress-text"></p></div>
    </div>
  </div>

  <!-- PDF 結合 -->
  <div id="tool-merge" class="tool-view" hidden>
    <div class="container">
      <button class="back-btn" data-back>&larr; ツール一覧に戻る</button>
      <h2>PDF 結合</h2>
      <div class="upload-area" id="merge-drop-area">
        <p>複数のPDFファイルをドラッグ&ドロップ<br>または</p>
        <label class="file-label">ファイルを選択<input type="file" id="merge-file-input" accept=".pdf" multiple hidden></label>
      </div>
      <div id="merge-file-list" class="file-list"></div>
      <div id="merge-actions" style="display:none;">
        <button id="add-more-btn" class="btn secondary">ファイルを追加</button>
        <input type="file" id="merge-add-input" accept=".pdf" multiple hidden>
        <button id="merge-btn" class="btn primary">結合する</button>
      </div>
      <div class="progress-wrapper" id="merge-progress" style="display:none;"><div class="progress-bar"><div class="progress-fill" id="merge-progress-fill"></div></div><p class="progress-text" id="merge-progress-text"></p></div>
    </div>
  </div>

  <!-- PDF 分割 -->
  <div id="tool-split" class="tool-view" hidden>
    <div class="container">
      <button class="back-btn" data-back>&larr; ツール一覧に戻る</button>
      <h2>PDF 分割</h2>
      <div class="upload-area" id="split-drop-area">
        <p>PDFファイルをドラッグ&ドロップ<br>または</p>
        <label class="file-label">ファイルを選択<input type="file" id="split-file-input" accept=".pdf" hidden></label>
      </div>
      <div id="split-options" style="display:none;">
        <div class="options">
          <label>分割方法: <select id="split-mode">
            <option value="each">1ページずつ</option>
            <option value="range">ページ範囲を指定</option>
            <option value="every">Nページごと</option>
          </select></label>
          <div id="split-range-input" style="display:none;"><label>ページ範囲 (例: 1-3, 5, 7-10): <input type="text" id="split-range-text" class="text-input" placeholder="1-3, 5, 7-10"></label></div>
          <div id="split-every-input" style="display:none;"><label>ページ数: <input type="number" id="split-every-n" class="text-input" value="2" min="1" style="width:80px"></label></div>
        </div>
        <p id="split-page-info" class="info-text"></p>
        <button id="split-btn" class="btn primary">分割する</button>
      </div>
      <div class="progress-wrapper" id="split-progress" style="display:none;"><div class="progress-bar"><div class="progress-fill" id="split-progress-fill"></div></div><p class="progress-text" id="split-progress-text"></p></div>
    </div>
  </div>

  <!-- ページ削除 -->
  <div id="tool-delete" class="tool-view" hidden>
    <div class="container">
      <button class="back-btn" data-back>&larr; ツール一覧に戻る</button>
      <h2>ページ削除</h2>
      <div class="upload-area" id="del-drop-area">
        <p>PDFファイルをドラッグ&ドロップ<br>または</p>
        <label class="file-label">ファイルを選択<input type="file" id="del-file-input" accept=".pdf" hidden></label>
      </div>
      <div id="del-ui" style="display:none;">
        <p class="info-text" id="del-page-info"></p>
        <div id="del-thumbs" class="thumb-grid"></div>
        <button id="del-btn" class="btn primary" disabled>選択したページを削除してダウンロード</button>
      </div>
      <div class="progress-wrapper" id="del-progress" style="display:none;"><div class="progress-bar"><div class="progress-fill" id="del-progress-fill"></div></div><p class="progress-text" id="del-progress-text"></p></div>
    </div>
  </div>

  <!-- ページ抽出 -->
  <div id="tool-extract" class="tool-view" hidden>
    <div class="container">
      <button class="back-btn" data-back>&larr; ツール一覧に戻る</button>
      <h2>ページ抽出</h2>
      <div class="upload-area" id="ext-drop-area">
        <p>PDFファイルをドラッグ&ドロップ<br>または</p>
        <label class="file-label">ファイルを選択<input type="file" id="ext-file-input" accept=".pdf" hidden></label>
      </div>
      <div id="ext-ui" style="display:none;">
        <p class="info-text" id="ext-page-info"></p>
        <div id="ext-thumbs" class="thumb-grid"></div>
        <button id="ext-btn" class="btn primary" disabled>選択したページを抽出してダウンロード</button>
      </div>
      <div class="progress-wrapper" id="ext-progress" style="display:none;"><div class="progress-bar"><div class="progress-fill" id="ext-progress-fill"></div></div><p class="progress-text" id="ext-progress-text"></p></div>
    </div>
  </div>

  <!-- ページ並び替え -->
  <div id="tool-organize" class="tool-view" hidden>
    <div class="container">
      <button class="back-btn" data-back>&larr; ツール一覧に戻る</button>
      <h2>ページ並び替え</h2>
      <div class="upload-area" id="org-drop-area">
        <p>PDFファイルをドラッグ&ドロップ<br>または</p>
        <label class="file-label">ファイルを選択<input type="file" id="org-file-input" accept=".pdf" hidden></label>
      </div>
      <div id="org-ui" style="display:none;">
        <p class="info-text">ドラッグして並び替えてください</p>
        <div id="org-thumbs" class="thumb-grid"></div>
        <button id="org-btn" class="btn primary">この順序で保存</button>
      </div>
      <div class="progress-wrapper" id="org-progress" style="display:none;"><div class="progress-bar"><div class="progress-fill" id="org-progress-fill"></div></div><p class="progress-text" id="org-progress-text"></p></div>
    </div>
  </div>

  <!-- PDF 回転 -->
  <div id="tool-rotate" class="tool-view" hidden>
    <div class="container">
      <button class="back-btn" data-back>&larr; ツール一覧に戻る</button>
      <h2>PDF 回転</h2>
      <div class="upload-area" id="rot-drop-area">
        <p>PDFファイルをドラッグ&ドロップ<br>または</p>
        <label class="file-label">ファイルを選択<input type="file" id="rot-file-input" accept=".pdf" hidden></label>
      </div>
      <div id="rot-ui" style="display:none;">
        <div class="options">
          <button id="rot-all-left" class="btn secondary">全ページ左90°</button>
          <button id="rot-all-right" class="btn secondary">全ページ右90°</button>
        </div>
        <p class="info-text">クリックで個別に回転できます</p>
        <div id="rot-thumbs" class="thumb-grid"></div>
        <button id="rot-btn" class="btn primary">保存してダウンロード</button>
      </div>
      <div class="progress-wrapper" id="rot-progress" style="display:none;"><div class="progress-bar"><div class="progress-fill" id="rot-progress-fill"></div></div><p class="progress-text" id="rot-progress-text"></p></div>
    </div>
  </div>

  <!-- ページ番号 -->
  <div id="tool-pagenums" class="tool-view" hidden>
    <div class="container">
      <button class="back-btn" data-back>&larr; ツール一覧に戻る</button>
      <h2>ページ番号を追加</h2>
      <div class="upload-area" id="pn-drop-area">
        <p>PDFファイルをドラッグ&ドロップ<br>または</p>
        <label class="file-label">ファイルを選択<input type="file" id="pn-file-input" accept=".pdf" hidden></label>
      </div>
      <div id="pn-options" style="display:none;">
        <div class="options">
          <label>位置: <select id="pn-position"><option value="bottom-center">下部中央</option><option value="bottom-left">下部左</option><option value="bottom-right">下部右</option><option value="top-center">上部中央</option><option value="top-left">上部左</option><option value="top-right">上部右</option></select></label>
          <label>開始番号: <input type="number" id="pn-start" class="text-input" value="1" min="1" style="width:80px"></label>
          <label>フォントサイズ: <input type="number" id="pn-fontsize" class="text-input" value="12" min="6" max="72" style="width:80px"></label>
        </div>
        <p class="info-text" id="pn-page-info"></p>
        <button id="pn-btn" class="btn primary">ページ番号を追加してダウンロード</button>
      </div>
      <div class="progress-wrapper" id="pn-progress" style="display:none;"><div class="progress-bar"><div class="progress-fill" id="pn-progress-fill"></div></div><p class="progress-text" id="pn-progress-text"></p></div>
    </div>
  </div>

  <!-- 透かし -->
  <div id="tool-watermark" class="tool-view" hidden>
    <div class="container">
      <button class="back-btn" data-back>&larr; ツール一覧に戻る</button>
      <h2>透かしを追加</h2>
      <div class="upload-area" id="wm-drop-area">
        <p>PDFファイルをドラッグ&ドロップ<br>または</p>
        <label class="file-label">ファイルを選択<input type="file" id="wm-file-input" accept=".pdf" hidden></label>
      </div>
      <div id="wm-options" style="display:none;">
        <div class="options">
          <label>テキスト: <input type="text" id="wm-text" class="text-input" value="CONFIDENTIAL" placeholder="透かしテキスト"></label>
          <label>フォントサイズ: <input type="number" id="wm-fontsize" class="text-input" value="60" min="10" max="200" style="width:80px"></label>
          <label>透明度: <input type="range" id="wm-opacity" min="5" max="100" value="30" step="5"><span id="wm-opacity-value">30%</span></label>
          <label>角度: <input type="number" id="wm-angle" class="text-input" value="45" min="-180" max="180" style="width:80px">°</label>
          <label>色: <input type="color" id="wm-color" value="#888888"></label>
        </div>
        <p class="info-text" id="wm-page-info"></p>
        <button id="wm-btn" class="btn primary">透かしを追加してダウンロード</button>
      </div>
      <div class="progress-wrapper" id="wm-progress" style="display:none;"><div class="progress-bar"><div class="progress-fill" id="wm-progress-fill"></div></div><p class="progress-text" id="wm-progress-text"></p></div>
    </div>
  </div>

  <!-- PDF 圧縮 -->
  <div id="tool-compress" class="tool-view" hidden>
    <div class="container">
      <button class="back-btn" data-back>&larr; ツール一覧に戻る</button>
      <h2>PDF 圧縮</h2>
      <div class="upload-area" id="cmp-drop-area">
        <p>PDFファイルをドラッグ&ドロップ<br>または</p>
        <label class="file-label">ファイルを選択<input type="file" id="cmp-file-input" accept=".pdf" hidden></label>
      </div>
      <div id="cmp-options" style="display:none;">
        <div class="options">
          <label>画像品質: <select id="cmp-quality"><option value="0.8">高品質 (おすすめ)</option><option value="0.5">中品質</option><option value="0.3">低品質 (最小サイズ)</option></select></label>
        </div>
        <p class="info-text" id="cmp-page-info"></p>
        <button id="cmp-btn" class="btn primary">圧縮してダウンロード</button>
      </div>
      <div class="progress-wrapper" id="cmp-progress" style="display:none;"><div class="progress-bar"><div class="progress-fill" id="cmp-progress-fill"></div></div><p class="progress-text" id="cmp-progress-text"></p></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    // ===== Navigation =====
    function showTool(toolId) {
      document.getElementById('home').hidden = true;
      document.querySelectorAll('.tool-view').forEach(v => v.hidden = true);
      document.getElementById('tool-' + toolId).hidden = false;
    }
    function showHome() {
      document.querySelectorAll('.tool-view').forEach(v => v.hidden = true);
      document.getElementById('home').hidden = false;
    }
    document.querySelectorAll('.tool-card').forEach(card => {
      card.addEventListener('click', () => showTool(card.dataset.tool));
    });
    document.querySelectorAll('[data-back]').forEach(btn => {
      btn.addEventListener('click', showHome);
    });

    // ===== Shared helpers =====
    function setupDropArea(dropId, inputId, onFiles) {
      const drop = document.getElementById(dropId);
      const input = document.getElementById(inputId);
      drop.addEventListener('dragover', e => { e.preventDefault(); drop.classList.add('dragover'); });
      drop.addEventListener('dragleave', () => drop.classList.remove('dragover'));
      drop.addEventListener('drop', e => {
        e.preventDefault(); drop.classList.remove('dragover');
        onFiles(Array.from(e.dataTransfer.files));
      });
      drop.addEventListener('click', e => { if (!e.target.closest('.file-label')) input.click(); });
      input.addEventListener('change', () => { onFiles(Array.from(input.files)); input.value = ''; });
    }
    function downloadBlob(blob, name) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = name; a.click();
      URL.revokeObjectURL(url);
    }
    function setProgress(fillId, textId, pct, text) {
      document.getElementById(fillId).style.width = pct + '%';
      document.getElementById(textId).textContent = text;
    }
  </script>
  <script src="js/pdf-to-png.js" type="module"></script>
  <script src="js/pdf-merge.js"></script>
  <script src="js/pdf-split.js"></script>
  <script src="js/pdf-delete.js" type="module"></script>
  <script src="js/pdf-extract.js" type="module"></script>
  <script src="js/pdf-organize.js" type="module"></script>
  <script src="js/pdf-rotate.js" type="module"></script>
  <script src="js/img-to-pdf.js"></script>
  <script src="js/pdf-pagenums.js"></script>
  <script src="js/pdf-watermark.js"></script>
  <script src="js/pdf-compress.js" type="module"></script>
</body>
</html>
